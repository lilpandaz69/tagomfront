<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="assets/Tagomlogo.png" alt="TAGOM Logo" class="logo-img" />
      <p class="version">TAGOM v.01</p>
    </div>

    <nav class="menu">
      <a class="menu-item" routerLink="/dashboard">Dashboard</a>
      <a class="menu-item" routerLink="/product">Product</a>
      <a class="menu-item active" routerLink="/customers">Customers</a>
      <a class="menu-item" routerLink="/supplier">Suppliers</a>
      <a class="menu-item" routerLink="/sale">Sales</a>
    </nav>

    <div class="profile">
      <img src="assets/raw.png" alt="User" class="profile-img" />
      <div class="profile-info">
        <h4 *ngIf="role.toLowerCase() === 'owner'; else staffName">Mr {{ username }}</h4>
        <ng-template #staffName>{{ username || 'Staff' }}</ng-template>
        <p>{{ role }}</p>
      </div>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Cards -->
    <div class="cards-grid">
      <div class="card small">
        <div class="card-icon">üßë‚Äçü§ù‚Äçüßë</div>
        <h3>Total Customers</h3>
        <div class="kpi">{{ totalCount | number }}</div>
      </div>
      <div class="card small">
        <div class="card-icon">‚ú®</div>
        <h3>Sort</h3>
        <div class="kpi">{{ sort | titlecase }}</div>
      </div>
    </div>

    <!-- Customers Panel -->
    <section class="panel">
      <div class="panel-head">
        <div>
          <h3 class="panel-title">All Customers</h3>
          <span class="muted">Manage, search, and add customers</span>
        </div>

        <div class="actions">
          <button class="btn primary" (click)="openAdd()">Add New Customer</button>
          <input type="search" placeholder="Search" (input)="onSearch($event)" />
          <select (change)="onSortChange($event)">
            <option value="newest" selected>Newest</option>
            <option value="oldest">Oldest</option>
          </select>
        </div>
      </div>

      <!-- Table -->
      <div class="table-wrap" *ngIf="!loading; else loadingTpl">
        <table class="grid">
          <thead>
            <tr>
              <th>Customer Name</th>
              <th>Phone</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of customers">
              <td>{{ c.name }}</td>
              <td>{{ c.phone }}</td>
              <td>{{ c.email || '‚Äî' }}</td>
            </tr>
            <tr *ngIf="!customers.length">
              <td colspan="4" class="empty">No customers found</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Footer -->
      <div class="panel-footer">
        <div class="hint">Page {{ page }} of {{ totalPages }}</div>
        <div class="pager">
          <button (click)="go(page - 1)" [disabled]="page === 1">¬´</button>
          <button
            *ngFor="let p of [].constructor(totalPages); let i = index"
            [class.active]="page === i + 1"
            (click)="go(i + 1)">
            {{ i + 1 }}
          </button>
          <button (click)="go(page + 1)" [disabled]="page === totalPages">¬ª</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Add Customer Modal -->
  <div class="modal-backdrop" *ngIf="showAddForm" (click)="closeAdd()"></div>
  <div class="modal" *ngIf="showAddForm">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <h3>Add New Customer</h3>

      <form [formGroup]="addForm">
        <div class="form-grid">
          <label>Full Name</label>
          <input type="text" formControlName="name" placeholder="Enter full name" />

          <label>Phone</label>
          <input type="text" formControlName="phone" placeholder="Enter phone number" />

          <!-- ‚ö†Ô∏è Error messages for phone -->
          <div *ngIf="addForm.get('phone')?.touched && addForm.get('phone')?.hasError('required')" class="error">
            Phone number is required.
          </div>
          <div *ngIf="addForm.get('phone')?.touched && addForm.get('phone')?.hasError('minlength')" class="error">
            Phone number is too short.
          </div>
          <div *ngIf="addForm.get('phone')?.hasError('duplicate')" class="error">
            This phone number already exists.
          </div>

          <label>Email</label>
          <input type="email" formControlName="email" placeholder="Enter email address" />
        </div>

        <div class="btn-row">
          <button type="button" class="btn primary" (click)="addCustomer()" [disabled]="addForm.invalid || loading">
            {{ loading ? 'Saving...' : 'Save' }}
          </button>
          <button type="button" class="btn ghost" (click)="closeAdd()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">Loading‚Ä¶</div>
  </ng-template>
</div>
